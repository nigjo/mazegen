<!DOCTYPE html>
<html>
  <head>
    <title>Dungeon Walls</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="res/gh-fork-ribbon.css"/>
    <link rel="stylesheet" href="res/mazeviewer.css"/>
    <script src="res/mazeviewer.js" type="module"></script>
    <script id="mazeinfoInit">
      window.mazeinfo = {
        seedtext: new Date().toLocaleString(),
        width: 6,
        height: 6
      };
    </script>
    <script>
      function updateMaze(evt) {
        console.debug(evt);
        evt.preventDefault();
        window.mazeinfo.seedtext = evt.target.seedText.value;
        window.mazeinfo.width = Number(evt.target.width.value);
        window.mazeinfo.height = Number(evt.target.height.value);
        window.mazeinfo.update();
        return false;
      }
    </script>
    <script>
      let alphabeth = "abcdefghijklmnopqrstuvwxyz";
      alphabeth += alphabeth.toUpperCase();
      alphabeth += "0123456789";
      function createRandom() {
        let form = document.forms.settings;
        let seed = '';
        for (let i = 0; i < 12; i++) {
          seed += alphabeth.charAt(Math.random() * alphabeth.length);
        }
        form.seedText.value = seed;
        form.requestSubmit();
      }
    </script>
    <script>
      document.addEventListener('readystatechange', (e) => {
        if (document.readyState === 'interactive') {
          console.debug('init query');
          let q = new URLSearchParams(location.search);
          let form = document.forms.settings;
          if (q.has('seedText')) {
            window.mazeinfo.seedtext
                    = form.seedText.value
                    = q.get('seedText');
          }
          if (q.has('width')) {
            window.mazeinfo.width
                    = form.width.value
                    = Number(q.get('width'));
          }
          if (q.has('height')) {
            window.mazeinfo.height
                    = form.height.value
                    = Number(q.get('height'));
          }
        }
      });
    </script>
  </head>
  <body>
    <header><h1>Irrgarten<span id="seedtext"></span></h1></header>
    <nav></nav>
    <main>
      <div>
        <form id="settings" name="settings" onsubmit="updateMaze(event);return false;">
          <label>Seed
            <input name="seedText" placeholder="Text oder Zahlwert"
                   size="15" required pattern="\d+|.+">
          </label>
          <label>Breite <input type="number" name="width" style="width:4em" min="2" value="6"></label>
          <label>Höhe <input type="number" name="height" style="width:4em" min="2" value="6"></label>
          <input type="submit" value="Update">
          <input type="button" value="Random" onclick="createRandom()">
        </form>
      </div>
      <div id="views"></div>
    </main>
    <footer>
      &copy; <a href="https://github.com/nigjo">Jens Hofschröer</a>
      <a class="github-fork-ribbon" href="https://github.com/nigjo/mazegen" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    </footer>
  </body>
</html>